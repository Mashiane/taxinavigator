function Institution(id,name){savethefunction_rvar="";this.id=id;this.name=name;return savethefunction_rvar;}
function saveInstitution(){savethefunction_rvar="";var s;sqlList=[];s=Join([this.id,"'"+this.name+"'"],",");sqlList[0]=["INSERT INTO Institutions (Id, Name) VALUES ( "+s+");",saveInstOk,saveInstError];Sql(dbObj,sqlList);return savethefunction_rvar;}
function saveInstOk(transaction,results){savethefunction_rvar="";NSB.MsgBox("Institution successfully saved.");return savethefunction_rvar;}
function saveInstError(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function AddInstitution(sname){savethefunction_rvar="";sname=InSingleQuote(sname);dbRecord=new Object();dbRecord["Name"]=sname;InsertRecord("Institutions",dbRecord);}
function nextInstId(){savethefunction_rvar="";sqlList=[];sqlList[0]=["SELECT MAX(Id) as MaxValue FROM Institutions;",maxOk,maxError];Sql(dbObj,sqlList);return savethefunction_rvar;}
function maxOk(transaction,results){savethefunction_rvar="";this.id=results.rows.item(0)["MaxValue"];this.id=this.id+1;return savethefunction_rvar;}
function maxError(transaction,results){savethefunction_rvar="";this.id=-1;NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
Institution.prototype.nextid=nextInstId;Institution.prototype.save=saveInstitution;function Institutions_CreateTable(){var tbls;tbls=new Object();tbls["Id"]="integer";tbls["Name"]="text";CreateTable("Institutions",tbls,"Id","Id");CreateTableIndexes("Institutions","Name");}
function Trial_CreateTable(){var tbls;tbls=new Object();tbls["IMEI"]="text";tbls["Runs"]="integer";CreateTable("Trial",tbls,"IMEI","");CreateTableIndexes("Trial","Runs");}
var dbExport;var dbJSON;var dbImport;function Main(){NSB.MsgBoxStyle="";sqlList=[];document.addEventListener("backbutton",onBackButton,False);document.addEventListener("menubutton",onMenuButton,False);dbName="taxinavigator.db";dbObj=SqlOpenDatabase(dbName);if(dbObj==0){NSB.MsgBox("Error opening "+dbName+" database!");}
NSB.ShowProgress("Working on it...");CreateTables();}
function CreateTables(){savethefunction_rvar="";Provinces_CreateTable();Trial_CreateTable();Users_CreateTable();NSB.ShowProgress(False);return savethefunction_rvar;}
function onBackButton(){savethefunction_rvar="";return savethefunction_rvar;}
function onMenuButton(){savethefunction_rvar="";return savethefunction_rvar;}
function Users_CreateTable(){var tblStructure;tblStructure=new Object();tblStructure["Id"]="INTEGER";tblStructure["UserName"]="TEXT";tblStructure["Password"]="TEXT";tblStructure["LastName"]="TEXT";tblStructure["FirstName"]="TEXT";tblStructure["FullName"]="TEXT";tblStructure["EmailAddress"]="TEXT";tblStructure["DBase"]="TEXT";CreateTable("Users",tblStructure,"Id","Id");CreateTableIndexes("Users","FullName,UserName,Password");}
function Provinces_CreateTable(){var tbls;tbls=new Object();tbls["ID"]="INTEGER";tbls["Description"]="TEXT";tbls["Companies"]="INTEGER";CreateTable("Provinces",tbls,"ID","ID");CreateTableIndexes("Provinces","Companies,Description");}
var dbName;var dbObj;var catFrom,sqlList,rCnt,query,recid,isnew;var DB_REAL="REAL";var DB_INTEGER="INTEGER";var DB_BLOB="BLOB";var DB_TEXT="TEXT";var DB_FLOAT="FLOAT";var DB_NUMERIC="NUMERIC";var VM=Chr(253);var FM=Chr(254);var Quote=Chr(34);var DQuote=Chr(34)+Chr(34);var InsertCommands,UpdateCommands,dbExport,dbJSON,dbImport;function InDoubleQuotes(svalue){savethefunction_rvar="";svalue=Quote+svalue+Quote;return svalue;return savethefunction_rvar;}
function TableDistinctList(sourceTable,sourceField){savethefunction_rvar="";localStorage.setItem("distinct",sourceField);var cboList;cboList=[];query="SELECT ["+sourceField+"]  FROM ["+sourceTable+"] ORDER BY ["+sourceField+"];";cboList[0]=[query,TableDistinctList1];Sql(dbObj,cboList);return savethefunction_rvar;}
function TableDistinctList1(transaction,results){savethefunction_rvar="";var row,i,sdistinct,svalue,svalues;sdistinct=localStorage.getItem("distinct");svalues="";for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);svalue=row[sdistinct];svalues=svalues+svalue+FM;}
svalues=RemoveDelim(svalues,FM);localStorage.setItem("distinct_"+sdistinct,svalues);return savethefunction_rvar;}
function ComboBoxDef(){savethefunction_rvar="";var strDef;strDef="<html><Select style="+DQuote;strDef=strDef+" name="+DQuote;strDef=strDef+" data-role="+InDoubleQuotes("none")+">";strDef=strDef+"<Option value="+DQuote+"></Option></Select>";strDef=strDef+"<span Class="+InDoubleQuotes("arrow")+"></span></html>";return strDef;return savethefunction_rvar;}
function NumericOnly(svalue){savethefunction_rvar="";var sout,lenvalue,i,spart;sout="";lenvalue=Len(svalue);for(i=1;i<=lenvalue;i++){spart=Mid(svalue,i,1);switch(True){case((spart)=="1"):sout=sout+spart;break;case((spart)=="2"):sout=sout+spart;break;case((spart)=="3"):sout=sout+spart;break;case((spart)=="4"):sout=sout+spart;break;case((spart)=="5"):sout=sout+spart;break;case((spart)=="6"):sout=sout+spart;break;case((spart)=="7"):sout=sout+spart;break;case((spart)=="8"):sout=sout+spart;break;case((spart)=="9"):sout=sout+spart;break;case((spart)=="0"):sout=sout+spart;break;case((spart)=="-"):sout=sout+spart;}}
return sout;return savethefunction_rvar;}
function FixMonths(smonths){savethefunction_rvar="";smonths=CStr(smonths);var lenx;lenx=Len(smonths);if(lenx==1){return smonths;}else{var part1,part2;part1=Left(smonths,1);part2=Mid(smonths,2);smonths=part1+"."+part2;smonths=Round(smonths,0);return smonths;}
return savethefunction_rvar;}
function InitializeList(lstname,stritems,delim,bclear){var spitems,rscnt,rstot,stritem;if(bclear==True){lstname.deleteItem("all");}
spitems=Split(stritems,delim);rstot=spitems.length-1;for(rscnt=0;rscnt<=rstot;rscnt++){stritem=spitems[rscnt];lstname.addItem(stritem);}
lstname.refresh();}
function ListAddTextDescription(targetList,stext,sdescription){stext="<span class="+InDoubleQuotes("name")+">"+stext+"</span><span class="+InDoubleQuotes("comment")+">"+sdescription+"</span>";targetList.addItem(stext);}
function ResizeHeaderList(form,header,child){child.Left=0;child.Top=header.Height;child.Height=form.Height-header.Height;child.refresh();}
function RemoveDelim(strmv,delim){savethefunction_rvar="";var lendelim,rightpart,strout;lendelim=Len(delim);rightpart=Right(strmv,lendelim);strout=strmv;if(rightpart==delim){strout=Left(strmv,Len(strmv)-lendelim);}
return strout;return savethefunction_rvar;}
function MvRemoteItem(strmv,sremove,delim){savethefunction_rvar="";sremove=LCase(sremove);var sout,lendelim;sout="";var spv;spv=Split(strmv,delim);var stot,scnt,sitem;lendelim=Len(delim);stot=spv.length-1;for(scnt=0;scnt<=stot;scnt++){sitem=LCase(spv[scnt]);if(sitem!=sremove){sout=sout+spv[scnt]+delim;}}
sout=Left(sout,Len(sout)-lendelim);return sout;return savethefunction_rvar;}
function MvSearch(searchvalues,strsearch,delim){savethefunction_rvar="";if(Len(searchvalues)==0){return-1;}
var spvalues,i,itot,ivalue;spvalues=Split(searchvalues,delim);strsearch=LCase(strsearch);itot=spvalues.length-1;for(i=0;i<=itot;i++){ivalue=spvalues[i];ivalue=LCase(ivalue);if(ivalue==strsearch){return i;}}
return-1;return savethefunction_rvar;}
function DbDateOut(sDate){savethefunction_rvar="";var xToday;xToday=CDate(sDate);xToday=FormatDateTime(xToday,"DD/MM/YYYY");return xToday;return savethefunction_rvar;}
function DbDateOut1(sDate){savethefunction_rvar="";var xToday;xToday=CDate(sDate);xToday=FormatDateTime(xToday,"YYYYMMDD");return xToday;return savethefunction_rvar;}
function ToDay(){savethefunction_rvar="";return FormatDateTime(dateadd("s",0,new Date()),"DD/MM/YYYY");return savethefunction_rvar;}
function ToDay1(){savethefunction_rvar="";return FormatDateTime(dateadd("s",0,new Date()),"YYYYMMDD");return savethefunction_rvar;}
function MvField(svalue,iposition,delimiter){savethefunction_rvar="";var mvalues,tvalues,xvalue;mvalues=Split(svalue,delimiter);tvalues=mvalues.length-1;iposition=iposition-1;if(iposition<=-1){xvalue=mvalues[tvalues];return xvalue;}
if(iposition>tvalues){return"";}
xvalue=mvalues[iposition];return xvalue;return savethefunction_rvar;}
function MvRest(svalue,iposition,delimiter){savethefunction_rvar="";var mvalues,tvalues,xvalue,x,y,resultx;var lendelim;lendelim=Len(delimiter);mvalues=Split(svalue,delimiter);tvalues=mvalues.length-1;iposition=iposition-1;if(iposition<=-1){xvalue=mvalues[tvalues];return xvalue;}
if(iposition>tvalues){return"";}
resultx="";x=iposition+1;for(y=x;y<=tvalues;y++){xvalue=mvalues[y];resultx=resultx+xvalue+delimiter;}
resultx=Left(resultx,Len(resultx)-lendelim);return resultx;return savethefunction_rvar;}
function MakeMoney(svalue){savethefunction_rvar="";svalue=ProperAmount(svalue);svalue=FormatNumber(svalue);return svalue;return savethefunction_rvar;}
function ProperAmount(svalue){savethefunction_rvar="";svalue=Replace(svalue,",","");dpos=InStr(1,svalue,".");if(dpos==0){svalue=svalue+".00";}
return svalue;return savethefunction_rvar;}
function InSingleQuote(strV){savethefunction_rvar="";return"'"+strV+"'";}
function MonthNames(intM){savethefunction_rvar="";return MonthName(intM,True);return savethefunction_rvar;}
function MonthNumber(strM){savethefunction_rvar="";strM=LCase(strM);switch(True){case((strM)=="jan"):return 1;break;case((strM)=="feb"):return 2;break;case((strM)=="mar"):return 3;break;case((strM)=="apr"):return 4;break;case((strM)=="may"):return 5;break;case((strM)=="jun"):return 6;break;case((strM)=="jul"):return 7;break;case((strM)=="aug"):return 8;break;case((strM)=="sep"):return 9;break;case((strM)=="oct"):return 10;break;case((strM)=="nov"):return 11;break;case((strM)=="dec"):return 12;}
return savethefunction_rvar;}
function SetHeaderTitle(hdObj,hdTitle){var shd;shd="#"+hdObj+" h1";$(shd).text(hdTitle);}
function GridRowColColour(grdName,rowPos,colPos,colour){grdName.cell(rowPos,colPos).style.color=colour;grdName.refresh();}
function GridRowColBackgroundColour(grdName,rowPos,colPos,colour){grdName.cell(rowPos,colPos).style.backgroundColor=colour;grdName.refresh();}
function GridRowColor(grdName,rowPos,colour){var grdCols,i;grdCols=grdName.getColCount();for(i=0;i<=grdCols-1;i++){grdName.cell(rowPos,i).style.color=color;}
grdName.refresh();}
function GridCenterAlign(grdName,startCol,endCol){var grdRows,i;grdRows=grdName.getRowCount();for(i=1;i<=grdRows-1;i++){for(col=startCol;col<=endCol;col++){grdName.cell(i,col).style.textAlign="center";}}
grdName.refresh();}
function GridRightAlign(grdName,startCol,endCol){var grdRows,i;grdRows=grdName.getRowCount();for(i=1;i<=grdRows-1;i++){for(col=startCol;col<=endCol;col++){grdName.cell(i,col).style.textAlign="right";}}
grdName.refresh();}
function GridSetHeight(grdName,grdRowHeight){var grdRows,i;grdRows=grdName.getRowCount();for(i=1;i<=grdRows-1;i++){grdName.setRowHeight(i,grdRowHeight);}
grdName.refresh();}
function GridBoldRow(grdName,rowPos){var grdCols,i;grdCols=grdName.getColCount();for(i=0;i<=grdCols-1;i++){grdName.cell(rowPos,i).style.fontWeight="bold";}
grdName.refresh();}
function GridAlternateColor(grdName){var grdRows,grdCols,i;grdRows=grdName.getRowCount();grdCols=grdName.getColCount();for(i=1;i<=grdRows-1;i++){for(col=0;col<=grdCols-1;col++){if((Math.abs(i)%2)==1){grdName.cell(i,col).style.backgroundColor=RGB(255,255,240);}else{grdName.cell(i,col).style.backgroundColor=RGB(240,248,255);}}}
grdName.refresh();}
function InsertRecord(tblName,tblRecord){savethefunction_rvar="";var sqlInst;sqlInst=[];var flds,vals;flds="";vals="";for(item in tblRecord){flds=flds+"["+item+"],";vals=vals+tblRecord[item]+",";}
flds=Left(flds,Len(flds)-1);vals=Left(vals,Len(vals)-1);sqlInst[0]="INSERT OR REPLACE INTO ["+tblName+"] ("+flds+") VALUES ("+vals+");";Sql(dbObj,sqlInst);return savethefunction_rvar;}
function InsertRecord1(tblName,tblRecord,Position){savethefunction_rvar="";var flds,vals;flds="";vals="";for(item in tblRecord){flds=flds+"["+item+"],";vals=vals+tblRecord[item]+",";}
flds=Left(flds,Len(flds)-1);vals=Left(vals,Len(vals)-1);InsertCommands[Position]="INSERT OR REPLACE INTO ["+tblName+"] ("+flds+") VALUES ("+vals+");";return savethefunction_rvar;}
function CreateTable(TableName,FieldsAndTypes,PrimaryKey,AutoIncrement){savethefunction_rvar="";var sb,fdef,sqlCreate;sb="(";for(item in FieldsAndTypes){fdef="["+item+"] "+UCase(FieldsAndTypes[item]);sb=sb+fdef;if(item==PrimaryKey){sb=sb+" NOT NULL PRIMARY KEY";}
if(item==AutoIncrement){sb=sb+" AUTOINCREMENT";}
sb=sb+", ";}
sb=Left(sb,Len(sb)-2);sb=sb+")";sb="CREATE TABLE IF NOT EXISTS ["+TableName+"] "+sb+";";sqlCreate=[];sqlCreate[0]=sb;Sql(dbObj,sqlCreate);}
function DeleteIndex(TableName,idxname){savethefunction_rvar="";var idxkey,sb,delidx;idxkey=TableName+"_"+idxname;delidx=[];delidx[0]="DROP INDEX IF EXISTS "+idxkey+";";delidx[1]="DROP INDEX IF EXISTS "+idxname+";";Sql(dbObj,delidx);return savethefunction_rvar;}
function CreateTableIndexes(TableName,Indexes){savethefunction_rvar="";var sb,idef,sqlCreateIdx,idxname;var spidx,idxtot,idxcnt,idx;spidx=Split(Indexes,",");idxtot=spidx.length-1;sqlCreateIdx=[];for(idxcnt=0;idxcnt<=idxtot;idxcnt++){idx=spidx[idxcnt];idxname=TableName+"_"+idx;idef="CREATE INDEX IF NOT EXISTS ["+idxname+"] ON ["+TableName+"] (["+idx+"]);";sqlCreateIdx[idxcnt]=idef;}
Sql(dbObj,sqlCreateIdx);return savethefunction_rvar;}
function ResetInsertCommands(){savethefunction_rvar="";InsertCommands=[];return savethefunction_rvar;}
function ExecuteInsertCommands(){savethefunction_rvar="";Sql(dbObj,InsertCommands);return savethefunction_rvar;}
function ExecuteUpdateCommands(){savethefunction_rvar="";Sql(dbObj,UpdateCommands);return savethefunction_rvar;}
function MvSum(strvalues,delim){savethefunction_rvar="";var dtot,i;dtot=0;var spvalues;spvalues=Split(strvalues,delim);var dlen;dlen=spvalues.length-1;for(i=0;i<=dlen;i++){dtot=parseFloat(dtot)+parseFloat(spvalues[i]);}
dtot=Round(dtot,2);return dtot;return savethefunction_rvar;}
function DeleteTable(tblName){savethefunction_rvar="";var sqlD;sqlD=[];sqlD[0]=["DROP TABLE IF EXISTS ["+tblName+"];"];Sql(dbObj,sqlD);return savethefunction_rvar;}
function UpdateRecord(tblName,tblRecord,tblWhere){savethefunction_rvar="";var sqlUpd;sqlUpd=[];var vals,wvals;vals="";wvals="";for(item in tblRecord){vals=vals+"["+item+"] = "+tblRecord[item]+",";}
vals=Left(vals,Len(vals)-1);for(item in tblWhere){wvals=wvals+"["+item+"] = "+tblWhere[item]+",";}
wvals=Left(wvals,Len(wvals)-1);sqlUpd[0]="UPDATE ["+tblName+"] SET "+vals+" WHERE "+wvals+";";Sql(dbObj,sqlUpd);return savethefunction_rvar;}
function UpdateRecords(tblName,tblRecord){savethefunction_rvar="";var sqlUpd,vals;sqlUpd=[];vals="";for(item in tblRecord){vals=vals+"["+item+"] = "+tblRecord[item]+",";}
vals=Left(vals,Len(vals)-1);sqlUpd[0]="UPDATE ["+tblName+"] SET "+vals+";";Sql(dbObj,sqlUpd);return savethefunction_rvar;}
function DeleteRecord(tblName,tblWhere){savethefunction_rvar="";var sqlUpd;sqlUpd=[];var wvals;wvals="";for(item in tblWhere){wvals=wvals+"["+item+"] = "+tblWhere[item]+",";}
wvals=Left(wvals,Len(wvals)-1);sqlUpd[0]="DELETE FROM ["+tblName+"] WHERE "+wvals+";";Sql(dbObj,sqlUpd);return savethefunction_rvar;}
function DeleteRecords(tblName){savethefunction_rvar="";var sqlDel;sqlDel=[];sqlDel[0]="DELETE FROM ["+tblName+"];";Sql(dbObj,sqlDel);return savethefunction_rvar;}
function UpdateRecord1(tblName,tblRecord,tblWhere,Position){savethefunction_rvar="";var vals,wvals;vals="";wvals="";for(item in tblRecord){vals=vals+"["+item+"] = "+tblRecord[item]+",";}
vals=Left(vals,Len(vals)-1);for(item in tblWhere){wvals=wvals+"["+item+"] = "+tblWhere[item]+",";}
wvals=Left(wvals,Len(wvals)-1);UpdateCommands[Position]="UPDATE ["+tblName+"] SET "+vals+" WHERE "+wvals+";";return savethefunction_rvar;}
function ComboIndexOf(cboBox,cboSearch){savethefunction_rvar="";var cboOut;cboOut=-1;var cboTot;cboTot=cboBox.getItemCount();var xitem,i;for(i=0;i<=cboTot-1;i++){xitem=cboBox.List(i);if(xitem==cboSearch){return i;}}
return cboOut;return savethefunction_rvar;}
function GridDefault(grdName){savethefunction_rvar="";GridSetHeight(grdName,"32px");GridAlternateColor(grdName);return savethefunction_rvar;}
function GridAddRow(grdName,colValues,delim,rowPos){savethefunction_rvar="";var vTot,spvalues,i;spvalues=Split(colValues,delim);vTot=spvalues.length;grdName.addRows(1);for(i=0;i<=vTot-1;i++){grdName.setValue(rowPos,i,spvalues[i]);}
return savethefunction_rvar;}
function GridAddNextRow(grdName,colValues,delim){savethefunction_rvar="";var vTot,rowPos,spvalues,i;rowPos=grdName.getRowCount();spvalues=Split(colValues,delim);vTot=spvalues.length;grdName.addRows(1);for(i=0;i<=vTot-1;i++){grdName.setValue(rowPos,i,spvalues[i]);}
return savethefunction_rvar;}
function GridAddImage(grdName,rowPos,colPos,imgName){savethefunction_rvar="";var imgID,imgDef;imgID=grdName+"_"+rowPos+"_"+colPos;imgDef="<img width=25px height=25px style=cursor:pointer src='"+imgName+"' id='"+imgID+"'>";grdName.setValue(rowPos,colPos,imgDef);return savethefunction_rvar;}
function GridAddTextImage(grdName,rowPos,colPos,text,img){savethefunction_rvar="";var imgDef,imgID;imgID=grdName+"_"+rowPos+"_"+colPos;imgDef=text+"<img src='"+img+"' align='right' id='"+imgID+"'>";grdName.setValue(rowPos,colPos,imgDef);return savethefunction_rvar;}
function GridAddTextImageDefinition(grdName,rowPos,colPos,text,img){savethefunction_rvar="";var imgDef,imgID;imgID=grdName+"_"+rowPos+"_"+colPos;imgDef=text+"  <img width=20px height=20px src='"+img+"' align='right' id='"+imgID+"'>";return imgDef;return savethefunction_rvar;}
function GridAddImageDefinition(grdName,rowPos,colPos,imgName){savethefunction_rvar="";var imgID,imgDef;imgID=grdName+"_"+rowPos+"_"+colPos;imgDef="<img width=25px height=25px style=cursor:pointer src='"+imgName+"' id='"+imgID+"'>";return imgDef;return savethefunction_rvar;}
function GridAddImageDefinitionAction(grdName,grdAction,grdId,imgName){savethefunction_rvar="";var imgID,imgDef;imgID=grdName+"_"+grdAction+"_"+grdId;imgDef="<img width=25px height=25px style=cursor:pointer src='"+imgName+"' id='"+imgID+"'>";return imgDef;return savethefunction_rvar;}
function GridAddImageDelete(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"delete.png");return savethefunction_rvar;}
function GridAddImageEdit(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"edit.png");return savethefunction_rvar;}
function GridAddImageChart(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"chart.png");return savethefunction_rvar;}
function GridAddImageView(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"view.png");return savethefunction_rvar;}
function GridAddImagePayTo(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"payto.png");return savethefunction_rvar;}
function GridAddImageDrillDown(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"drill.png");return savethefunction_rvar;}
function GridAddImageDuplicate(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"duplicate.png");return savethefunction_rvar;}
function GridAddImageReverse(grdName,rowPos,colPos){savethefunction_rvar="";GridAddImage(grdName,rowPos,colPos,"reverse.png");return savethefunction_rvar;}
function email(t,subject,body){savethefunction_rvar="";location="mailto:"+encodeURI(t)+"?subject="+encodeURI(subject)+"&body="+encodeURI(body);return savethefunction_rvar;}
function phone(tel){savethefunction_rvar="";location="tel:"+tel;return savethefunction_rvar;}
function skype(tel){savethefunction_rvar="";location="skype:"+tel;return savethefunction_rvar;}
function sms(tel,body){savethefunction_rvar="";location="sms:"+tel+"?body="+encodeURL(body);return savethefunction_rvar;}
function ReadTableRecord(stable,sprimarykey,svalue,sfields){savethefunction_rvar="";var skey;skey=stable+"*"+svalue;localStorage.setItem("read_table",stable);localStorage.setItem("read_pk",sprimarykey);localStorage.setItem("read_id",svalue);localStorage.setItem("read_flds",sfields);localStorage.setItem(skey,"");query="select * from ["+stable+"] where ["+sprimarykey+"] = "+svalue+";";var sqlRead;sqlRead=[];sqlRead[0]=[query,ReadTableRecordH,ReadRecordE];Sql(dbObj,sqlRead);return savethefunction_rvar;}
function ReadTableRecordH(transaction,results){savethefunction_rvar="";var stable,spk,svalue,sfields,skey,spfields,ftot,row,rtot,fcnt,fstr,fvalue,sout;stable=localStorage.getItem("read_table");spk=localStorage.getItem("read_pk");svalue=localStorage.getItem("read_id");sfields=localStorage.getItem("read_flds");if(IsNull(stable)==True){return savethefunction_rvar;}
if(IsNull(spk)==True){return savethefunction_rvar;}
if(IsNull(svalue)==True){return savethefunction_rvar;}
if(IsNull(sfields)==True){return savethefunction_rvar;}
sout="";skey=stable+"*"+svalue;rtot=results.rows.length-1;if(_jsCint(rtot)==-1){return savethefunction_rvar;}
row=results.rows.item(0);spfields=Split(sfields,",");ftot=spfields.length-1;for(fcnt=0;fcnt<=ftot;fcnt++){fstr=spfields[fcnt];fvalue=row[fstr];if(IsNull(fvalue)==True){fvalue="";}
sout=sout+fvalue+FM;}
sout=RemoveDelim(sout,FM);localStorage.setItem(skey,sout);return savethefunction_rvar;}
function ReadRecordE(transaction,results){savethefunction_rvar="";currentRecord=null;NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function NextAvailableId(frmToShow){savethefunction_rvar="";var stable,sprimarykey,sqlList;localStorage.setItem("action","new");localStorage.setItem("form",frmToShow);stable=localStorage.getItem("table");sprimarykey=localStorage.getItem("primarykey");sqlList=[];sqlList[0]=["SELECT MAX("+sprimarykey+") as MaxValue FROM ["+stable+"];",NextAvailableIdH,NextAvailableIdE];Sql(dbObj,sqlList);return savethefunction_rvar;}
function NextAvailableIdH(transaction,results){savethefunction_rvar="";var sid,sform;sform=localStorage.getItem("form");sid=results.rows.item(0)["MaxValue"];sid=_jsCint(sid)+1;localStorage.setItem("id",sid);return savethefunction_rvar;}
function NextAvailableIdE(transaction,results){savethefunction_rvar="";localStorage.setItem("id","-1");NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function MapSum(mapobj,mapkey,mapitem){var xitem;xitem=mapobj[mapkey];if(IsNull(xitem)==True){mapobj[mapkey]=mapitem;}else{xitem=parseFloat(xitem)+parseFloat(mapitem);mapobj[mapkey]=xitem;}}
function MapUpdate(mapobj,mapkey,mapitem){var xitem;xitem=mapobj[mapkey];if(IsNull(xitem)==True){mapobj[mapkey]=mapitem;}else{mapobj[mapkey]=mapitem;}}
function MapSearch(mapobj,keySearch){savethefunction_rvar="";var xitem;xitem=mapobj[keySearch];if(IsNull(xitem)==True){return True;}else{return False;}
return savethefunction_rvar;}
function ListViewAddTitleDescription(lstView,Title,Description){savethefunction_rvar="";var stext;stext="<h2>"+Title+"</h2><p>"+Description+"</p>";lstView.addItem(stext);return savethefunction_rvar;}
function ListViewAddTitleDescriptionSideContent(lstView,Title,Description,Counted,Content){savethefunction_rvar="";var stext;stext="<h2>"+Title+"</h2><p>"+Description+"</p>";if(Len(Content)>0){stext=stext+"<span class='ui-li-aside'><p>"+Content+"</p></span>";}
if(Len(Counted)>0){stext=stext+"<span class='ui-li-count'>"+Counted+"</span>";}
lstView.addItem(stext);return savethefunction_rvar;}
function ListViewClear(lstView){savethefunction_rvar="";lstView.deleteItem("all");return savethefunction_rvar;}
function ListViewRefresh(lstView){savethefunction_rvar="";lstView.refresh();return savethefunction_rvar;}
function ListViewAddTitleCount(lstView,Title,Counted){savethefunction_rvar="";var stext;stext=Title+"<span class='ui-li-count'>"+Counted+"</span>";lstView.addItem(stext);return savethefunction_rvar;}
function Alphabets(svalue){savethefunction_rvar="";var sout,slen,i,schar;sout="";slen=Len(svalue);for(i=1;i<=slen;i++){schar=Mid(svalue,i,1);switch(True){case((schar)==0):break;case((schar)==1):break;case((schar)==2):break;case((schar)==3):break;case((schar)==4):break;case((schar)==5):break;case((schar)==6):break;case((schar)==7):break;case((schar)==8):break;case((schar)==9):break;default:sout=sout+schar;}}
return sout;return savethefunction_rvar;}
function ListViewAddTitleAsideContent(lstView,Title,Content){savethefunction_rvar="";var stext;stext=Title+"<span class='ui-li-aside'><p>"+Content+"</p></span>";lstView.addItem(stext);return savethefunction_rvar;}
function ListViewAddTextBoxWithLabel(lstView,id,caption){savethefunction_rvar="";var slabel;slabel="<label for='"+id+"'>"+caption+"</label>";var stext;stext="<input type='text' name='"+id+"' id='"+id+"' value=''/>";lstView.addItem(slabel+stext);return savethefunction_rvar;}
function ListViewAddTextBox(lstView,id,caption){savethefunction_rvar="";var stext;stext="<input type='text' name='"+id+"' id='"+id+"' value=''/>";lstView.addItem(stext);return savethefunction_rvar;}
function SaveSetting(key,value){savethefunction_rvar="";localStorage.setItem(key,value);return savethefunction_rvar;}
function GetSetting(key){savethefunction_rvar="";var svalue;svalue=localStorage.getItem(key);if(IsNull(svalue)==True){svalue="";}
return svalue;return savethefunction_rvar;}
window.addEventListener('load',function(){frmSignIn.style.display='block';NSB.addProperties(signInT);NSB.addDisableProperty(signInT);if(typeof(signInT.onclick)=='function'){if(typeof(signInT_left)!='undefined')signInT_left.onclick=function(){signInT.onclick(signInT_left.getAttribute('nsbvalue'))};if(typeof(signInT_right)!='undefined')signInT_right.onclick=function(){signInT.onclick(signInT_right.getAttribute('nsbvalue'))}};NSB.MultiInput_init('mSignIn');NSB.addProperties(mSignIn);frmSignIn.style.display='none';},false);frmSignIn.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmSignIn);var susername,spassword;signInT.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Sign In"):susername=mSignIn.getValue(1);susername=LCase(Trim(susername));if(Len(susername)==0){NSB.MsgBox("Please specify a user name!");return;}
spassword=mSignIn.getValue(2);spassword=LCase(Trim(spassword));if(Len(susername)==0){NSB.MsgBox("Please specify a password!");return;}
if(spassword=="demo"&&susername=="demo"){dbName="demo.db";SetDemo(6);ChangeForm(WhatToDo);return;}else{dbName=susername+".db";dbObj=SqlOpenDatabase(dbName);if(dbObj==0){NSB.MsgBox("Error opening "+susername+" database!");}}
NSB.ShowProgress("Working on it...");CreateTables();NSB.ShowProgress(False);var sqlList;sqlList=[];query="SELECT * FROM Users WHERE UserName = '"+susername+"' and Password = '"+spassword+"';";sqlList[0]=[query,CheckUser,CheckUserError];Sql(dbObj,sqlList);}
return savethefunction_rvar;}
function CheckUser(transaction,results){savethefunction_rvar="";var row,i,sFullName,sEmailAddress;var tusers;tusers=results.rows.length-1;if(_jsCint(tusers)==-1){NSB.MsgBox(RegisterAccount,"The account details you have specified cannot be found, would you like to register your account first?",4+32,"Confirm User");}else if(_jsCint(tusers)==0){row=results.rows.item(0);sFullName=row["FullName"];sEmailAddress=row["EmailAddress"];localStorage.setItem("email",sEmailAddress);localStorage.setItem("fullname",sFullName);ChangeForm(WhatToDo);}
return savethefunction_rvar;}
function RegisterAccount(result){if(result!=6){return;}
NSB.ShowProgress("Working on it...");}
function CheckUserError(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
frmSignIn.onshow=function(){savethefunction_rvar="";mSignIn.Left=0;mSignIn.Top=42;mSignIn.Width=frmSignIn.Width-20;mSignIn.setValue(1,"demo");mSignIn.setValue(2,"demo");return savethefunction_rvar;}
window.addEventListener('load',function(){frmRestore.style.display='block';NSB.addProperties(restoreT);NSB.addDisableProperty(restoreT);if(typeof(restoreT.onclick)=='function'){if(typeof(restoreT_left)!='undefined')restoreT_left.onclick=function(){restoreT.onclick(restoreT_left.getAttribute('nsbvalue'))};if(typeof(restoreT_right)!='undefined')restoreT_right.onclick=function(){restoreT.onclick(restoreT_right.getAttribute('nsbvalue'))}};txtRestore.ontouchmove=function(e){e.stopPropagation()};NSB.addProperties(txtRestore);frmRestore.style.display='none';},false);frmRestore.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmRestore);restoreT.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Home"):ChangeForm(WhatToDo);break;case((choice)=="Restore"):dbJSON=txtRestore.value;dbJSON=Trim(dbJSON);if(Len(dbJSON)==0){NSB.MsgBox("Please replace the text with the copied text from the 'Backup' E-Mail!");return;}
NSB.ShowProgress("Working on it...");dbImport=JSON.parse(dbJSON);SQLImport(dbImport,dbObj,restoreComplete);}
return savethefunction_rvar;}
function restoreComplete(){savethefunction_rvar="";NSB.ShowProgress(False);ChangeForm(WhatToDo);return savethefunction_rvar;}
frmRestore.onshow=function(){savethefunction_rvar="";txtRestore.Left=10;txtRestore.Top=42;txtRestore.Height=frmRestore.Height-restoreT.Height-10;txtRestore.Width=frmRestore.Width-20;txtRestore.value=localStorage.getItem("backup");return savethefunction_rvar;}
window.addEventListener('load',function(){frmSettings.style.display='block';NSB.List_jqm_init('lstWhatToDo1','Categories,Institutions,Accounts',true,'100%',false);lstWhatToDo1_ref=new iScroll('lstWhatToDo1_scroller',{bounce:true,zoom:false});lstWhatToDo1.refresh=function(){if(typeof lstWhatToDo1_ref!='undefined')setTimeout(NSB.refresh,100,lstWhatToDo1_ref)};NSB.addProperties(lstWhatToDo1,lstWhatToDo1_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstWhatToDo1_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(hBar1);NSB.addDisableProperty(hBar1);if(typeof(hBar1.onclick)=='function'){if(typeof(hBar1_left)!='undefined')hBar1_left.onclick=function(){hBar1.onclick(hBar1_left.getAttribute('nsbvalue'))};if(typeof(hBar1_right)!='undefined')hBar1_right.onclick=function(){hBar1.onclick(hBar1_right.getAttribute('nsbvalue'))}};frmSettings.style.display='none';},false);frmSettings.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmSettings);lstWhatToDo1.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var strItem;strItem=lstWhatToDo1.getItem(i);switch(True){case((strItem)=="Categories"):ChangeForm(CategoryList);break;case((strItem)=="Institutions"):ChangeForm(MyInstitutions,"slide");break;case((strItem)=="Accounts"):ChangeForm(MyAccounts,"slide");}
return savethefunction_rvar;}
frmSettings.onshow=function(){savethefunction_rvar="";lstWhatToDo1.Top=hBar1.Height;lstWhatToDo1.Height=frmSettings.Height-hBar1.Height;lstWhatToDo1.refresh();return savethefunction_rvar;}
hBar1.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Home"):ChangeForm(WhatToDo);}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmDatabase.style.display='block';NSB.List_jqm_init('lstWhatToDo2','Backup,Restore,Reset',true,'100%',false);lstWhatToDo2_ref=new iScroll('lstWhatToDo2_scroller',{bounce:true,zoom:false});lstWhatToDo2.refresh=function(){if(typeof lstWhatToDo2_ref!='undefined')setTimeout(NSB.refresh,100,lstWhatToDo2_ref)};NSB.addProperties(lstWhatToDo2,lstWhatToDo2_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('lstWhatToDo2_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(hBar2);NSB.addDisableProperty(hBar2);if(typeof(hBar2.onclick)=='function'){if(typeof(hBar2_left)!='undefined')hBar2_left.onclick=function(){hBar2.onclick(hBar2_left.getAttribute('nsbvalue'))};if(typeof(hBar2_right)!='undefined')hBar2_right.onclick=function(){hBar2.onclick(hBar2_right.getAttribute('nsbvalue'))}};frmDatabase.style.display='none';},false);frmDatabase.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmDatabase);lstWhatToDo2.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var strItem;strItem=lstWhatToDo2.getItem(i);switch(True){case((strItem)=="Backup"):if(isDemo==True){NSB.MsgBox("The system is in demo mode and backup cannot be executed!");return;}else{NSB.MsgBox(ContinueBackUp,"This will backup your database and email it to your email address. Please ensure you are connected to the internet.",4+32,"Confirm Backup");}
break;case((strItem)=="Restore"):if(isDemo==True){NSB.MsgBox("The system is in demo mode and restore cannot be executed!");return;}else{ChangeForm(frmRestore);}
break;case((strItem)=="Reset"):if(isDemo==True){NSB.MsgBox("The system is in demo mode and cannot be reset!");return;}else{NSB.MsgBox(ResetData,"This will clear all the payments data in database, are you sure?",4+32,"Confirm Reset");}}
return savethefunction_rvar;}
frmDatabase.onshow=function(){savethefunction_rvar="";lstWhatToDo2.Top=hBar2.Height;lstWhatToDo2.Height=frmDatabase.Height-hBar2.Height;lstWhatToDo2.refresh();return savethefunction_rvar;}
hBar2.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Home"):ChangeForm(WhatToDo);}
return savethefunction_rvar;}
function ContinueBackUp(result){if(result!=6){return;}
var delRec;delRec=new Object();NSB.ShowProgress("Working on it...");dbExport=SQLExport(dbObj,dbName,backupComplete);}
function backupComplete(){savethefunction_rvar="";var sEmailAddress;sEmailAddress=localStorage.getItem("email");if(sEmailAddress==null){sEmailAddress="";}
sEmailAddress=Replace(sEmailAddress,'\n',"");sEmailAddress=Replace(sEmailAddress,'\r',"");sEmailAddress=Replace(sEmailAddress,'\n',"");if(Len(sEmailAddress)==0){NSB.ShowProgress(False);NSB.MsgBox("Your email address has not been configured, please register your as a user first!");return;}
dbJSON=JSON.stringify(dbExport);NSB.ShowProgress(False);localStorage.setItem("backup",dbJSON);email(sEmailAddress,"MyMoney.Show "+dbName+" BackUp "+dateadd("s",0,new Date()),dbJSON);return savethefunction_rvar;}
window.addEventListener('load',function(){frmProvinces.style.display='block';NSB.List_jqm_init('provincesL','',true,'100%',false);provincesL_ref=new iScroll('provincesL_scroller',{bounce:true,zoom:false});provincesL.refresh=function(){if(typeof provincesL_ref!='undefined')setTimeout(NSB.refresh,100,provincesL_ref)};NSB.addProperties(provincesL,provincesL_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('provincesL_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(provincesH);NSB.addDisableProperty(provincesH);provincesH_left.onclick=function(){ChangeForm(WhatToDo)};if(typeof(provincesH.onclick)=='function'){if(typeof(provincesH_left)!='undefined')provincesH_left.onclick=function(){provincesH.onclick(provincesH_left.getAttribute('nsbvalue'))};if(typeof(provincesH_right)!='undefined')provincesH_right.onclick=function(){provincesH.onclick(provincesH_right.getAttribute('nsbvalue'))}};frmProvinces.style.display='none';},false);frmProvinces.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmProvinces);provincesL.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var strItem,sprov;strItem=provincesL.getItem(i);sprov=Alphabets(strItem);localStorage.setItem("province",sprov);localStorage.setItem("place","");ChangeForm(frmPlacesTaxi);return savethefunction_rvar;}
frmProvinces.onshow=function(){savethefunction_rvar="";document.body.style.cursor='wait';NSB.ShowProgress("Working on it...");provincesL.Top=provincesH.Height;provincesL.Height=frmProvinces.Height-provincesH.Height;ListViewRefresh(provincesL);var sqlList;sqlList=[];var query;query="SELECT * FROM Provinces ORDER BY Description;";sqlList[0]=[query,LoadProvinces,LoadProvincesError];Sql(dbObj,sqlList);return savethefunction_rvar;}
function LoadProvinces(transaction,results){savethefunction_rvar="";ListViewClear(provincesL);var row,i,sDescription,sCompanies,sID;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sID=row["ID"];sDescription=row["Description"];sCompanies=row["Companies"];if(IsNull(sDescription)==True){sDescription="";}
if(IsNull(sCompanies)==True){sCompanies="0";}
ListViewAddTitleCount(provincesL,sDescription,sCompanies);}
ListViewRefresh(provincesL);NSB.ShowProgress(False);document.body.style.cursor='default';return savethefunction_rvar;}
function LoadProvincesError(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
window.addEventListener('load',function(){frmPlacesEditor.style.display='block';NSB.MultiInput_init('placesEditor');NSB.addProperties(placesEditor);NSB.addProperties(placesEditorT);NSB.addDisableProperty(placesEditorT);if(typeof(placesEditorT.onclick)=='function'){if(typeof(placesEditorT_left)!='undefined')placesEditorT_left.onclick=function(){placesEditorT.onclick(placesEditorT_left.getAttribute('nsbvalue'))};if(typeof(placesEditorT_right)!='undefined')placesEditorT_right.onclick=function(){placesEditorT.onclick(placesEditorT_right.getAttribute('nsbvalue'))}};delete cboProvince.childNodes[0];NSB.ComboBox_init('cboProvince');NSB.addProperties(cboProvince);NSB.addDisableProperty(cmdAddPlace);NSB.addProperties(cmdAddPlace);frmPlacesEditor.style.display='none';},false);frmPlacesEditor.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmPlacesEditor);function LoadPlacesProvinces(){document.body.style.cursor='wait';var sd;NSB.ShowProgress("Loading...");cboProvince.clear();cboProvince.addItem("","");cboProvince.setIndex(0);sqlList=[];sqlList[0]=["select Description from Provinces order by Description;",provincesH,provincesE];Sql(dbObj,sqlList);}
function provincesE(transaction,results){savethefunction_rvar="";NSB.ShowProgress(False);document.body.style.cursor='default';NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function provincesH(transaction,results){savethefunction_rvar="";var row,sDescription,i;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sDescription=row["Description"];cboProvince.addItem(sDescription,sDescription);}
NSB.ShowProgress(False);document.body.style.cursor='default';return savethefunction_rvar;}
placesEditorT.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmPlaces);break;case((choice)=="Save"):PlaceSave();}
return savethefunction_rvar;}
frmPlacesEditor.onshow=function(){savethefunction_rvar="";placesEditor.Left=0;placesEditor.Top=42;placesEditor.Width=frmPlacesEditor.Width-20;var fw;fw=placesEditor.Width/2;cboProvince.Left=fw+10;cboProvince.Width=fw-10;LoadPlacesProvinces();var saction;saction=localStorage.getItem("action");var sid;acctName=localStorage.getItem("id");switch(True){case((saction)=="edit"):ReadPlaceById(sid);break;case((saction)=="add"):isnew=True;var sprov;sprov=localStorage.getItem("province");cboProvince.setText(sprov);placesEditor.setValue(2,"");placesEditor.setValue(3,"");placesEditor.setValue(4,"");}
return savethefunction_rvar;}
function ReadPlaceById(placeID){savethefunction_rvar="";var sqlread;sqlread=[];sqlread[0]=["SELECT * FROM [Places] WHERE [ID] = "+placeID+";",ReadPlaceH,ReadPlaceE];Sql(dbObj,sqlread);return savethefunction_rvar;}
function ReadPlaceE(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function ReadPlaceH(transaction,results){savethefunction_rvar="";var row,sid;var sProvince,sPlace,sLat,sLng;row=results.rows.item(0);sid=row["ID"];sProvince=row["ProvinceName"];sPlace=row["PlaceName"];sLat=row["Lat"];sLng=row["Lng"];cboProvince.setText(sProvince);placesEditor.setValue(2,sPlace);placesEditor.setValue(3,sLat);placesEditor.setValue(4,sLng);isnew=False;return savethefunction_rvar;}
function PlaceSave(){var dbRecord,sid,iSave;var sProvince,sPlace,sLat,sLng;sProvince=cboProvince.selectedItem();sPlace=placesEditor.getValue(2);sLat=placesEditor.getValue(3);sLng=placesEditor.getValue(4);sProvince=Trim(sProvince);sPlace=Trim(sPlace);sLat=Trim(sLat);sLng=Trim(sLng);iSave=0;if(Len(sProvince)==0){iSave=iSave+1;}
if(Len(sPlace)==0){iSave=iSave+1;}
if(iSave!=0){NSB.MsgBox("The place details are incomplete, please specify a province and name at least!");cboProvince.focus();return;}
localStorage.setItem("province",sProvince);sProvince=InSingleQuote(sProvince);sPlace=InSingleQuote(sPlace);sLat=InSingleQuote(sLat);sLng=InSingleQuote(sLng);dbRecord=new Object();dbRecord["ProvinceName"]=sProvince;dbRecord["PlaceName"]=sPlace;dbRecord["Lat"]=sLat;dbRecord["Lng"]=sLng;if(isnew==True){InsertRecord("Places",dbRecord);}else{var dbUpdate;dbUpdate=new Object();dbUpdate["ID"]=sid;UpdateRecord("Places",dbRecord,dbUpdate);}}
cmdAddPlace.onclick=function(){savethefunction_rvar="";localStorage.setItem("action","add");localStorage.setItem("id","-1");isnew=True;var sprov;sprov=localStorage.getItem("province");cboProvince.setText(sprov);placesEditor.setValue(2,"");placesEditor.setValue(3,"");placesEditor.setValue(4,"");return savethefunction_rvar;}
window.addEventListener('load',function(){frmPlaces.style.display='block';NSB.List_jqm_init('placesL','',true,'100%',false);placesL_ref=new iScroll('placesL_scroller',{bounce:true,zoom:false});placesL.refresh=function(){if(typeof placesL_ref!='undefined')setTimeout(NSB.refresh,100,placesL_ref)};NSB.addProperties(placesL,placesL_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('placesL_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(placesH);NSB.addDisableProperty(placesH);if(typeof(placesH.onclick)=='function'){if(typeof(placesH_left)!='undefined')placesH_left.onclick=function(){placesH.onclick(placesH_left.getAttribute('nsbvalue'))};if(typeof(placesH_right)!='undefined')placesH_right.onclick=function(){placesH.onclick(placesH_right.getAttribute('nsbvalue'))}};frmPlaces.style.display='none';},false);frmPlaces.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmPlaces);placesH.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmPlacesTaxi);break;case((choice)=="Add"):localStorage.setItem("action","add");localStorage.setItem("id","-1");isnew=True;ChangeForm(frmPlacesEditor);}
return savethefunction_rvar;}
placesL.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var strItem,splace;strItem=placesL.getItem(i);splace=Alphabets(strItem);localStorage.setItem("place",splace);ChangeForm(frmTaxis);return savethefunction_rvar;}
frmPlaces.onshow=function(){savethefunction_rvar="";document.body.style.cursor='wait';var sprov;sprov=localStorage.getItem("province");$("#placesH h1").text(sprov+" Places");NSB.ShowProgress("Working on it...");placesL.Top=placesH.Height;placesL.Height=frmPlaces.Height-placesH.Height;ListViewRefresh(placesL);var sqlList;sqlList=[];var query;query="SELECT * FROM Places WHERE ProvinceName = '"+sprov+"' ORDER BY PlaceName;";sqlList[0]=[query,LoadPlacesH,LoadPlacesE];Sql(dbObj,sqlList);return savethefunction_rvar;}
function LoadPlacesH(transaction,results){savethefunction_rvar="";ListViewClear(placesL);var row,i,sPlaceName,sCompanies,sid;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sid=row["ID"];sPlaceName=row["PlaceName"];sCompanies=row["Companies"];if(IsNull(sPlaceName)==True){sPlaceName="";}
if(IsNull(sCompanies)==True){sCompanies="0";}
ListViewAddTitleCount(placesL,sPlaceName,sCompanies);}
ListViewRefresh(placesL);NSB.ShowProgress(False);document.body.style.cursor='default';return savethefunction_rvar;}
function LoadPlacesE(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
window.addEventListener('load',function(){frmPlacesTaxi.style.display='block';NSB.List_jqm_init('placesTaxiL','',true,'100%',false);placesTaxiL_ref=new iScroll('placesTaxiL_scroller',{bounce:true,zoom:false});placesTaxiL.refresh=function(){if(typeof placesTaxiL_ref!='undefined')setTimeout(NSB.refresh,100,placesTaxiL_ref)};NSB.addProperties(placesTaxiL,placesTaxiL_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('placesTaxiL_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(placesTaxiH);NSB.addDisableProperty(placesTaxiH);placesTaxiH_left.onclick=function(){ChangeForm(frmProvinces)};if(typeof(placesTaxiH.onclick)=='function'){if(typeof(placesTaxiH_left)!='undefined')placesTaxiH_left.onclick=function(){placesTaxiH.onclick(placesTaxiH_left.getAttribute('nsbvalue'))};if(typeof(placesTaxiH_right)!='undefined')placesTaxiH_right.onclick=function(){placesTaxiH.onclick(placesTaxiH_right.getAttribute('nsbvalue'))}};frmPlacesTaxi.style.display='none';},false);frmPlacesTaxi.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmPlacesTaxi);placesTaxiL.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
switch(True){case((i)==0):localStorage.setItem("place","");localStorage.setItem("fromscreen","places");ChangeForm(frmPlaces);break;case((i)==1):localStorage.setItem("place","");localStorage.setItem("fromscreen","taxis");ChangeForm(frmTaxis);}
return savethefunction_rvar;}
frmPlacesTaxi.onshow=function(){savethefunction_rvar="";var sprov;sprov=localStorage.getItem("province");$("#placesTaxiH h1").text(sprov+" Places & Taxis");placesTaxiL.Top=placesTaxiH.Height;placesTaxiL.Height=frmPlacesTaxi.Height-placesTaxiH.Height;ListViewClear(placesTaxiL);ListViewAddTitleDescription(placesTaxiL,"Places","View places for the selected Province.");ListViewAddTitleDescription(placesTaxiL,"Taxis","View Taxis for the selected province.");ListViewRefresh(placesTaxiL);return savethefunction_rvar;}
window.addEventListener('load',function(){frmTaxisEditor.style.display='block';NSB.MultiInput_init('taxisEditor');NSB.addProperties(taxisEditor);NSB.addProperties(taxisEditorT);NSB.addDisableProperty(taxisEditorT);if(typeof(taxisEditorT.onclick)=='function'){if(typeof(taxisEditorT_left)!='undefined')taxisEditorT_left.onclick=function(){taxisEditorT.onclick(taxisEditorT_left.getAttribute('nsbvalue'))};if(typeof(taxisEditorT_right)!='undefined')taxisEditorT_right.onclick=function(){taxisEditorT.onclick(taxisEditorT_right.getAttribute('nsbvalue'))}};delete cboTaxiProvince.childNodes[0];NSB.ComboBox_init('cboTaxiProvince');NSB.addProperties(cboTaxiProvince);delete cboTaxiPlaceName.childNodes[0];NSB.ComboBox_init('cboTaxiPlaceName');NSB.addProperties(cboTaxiPlaceName);frmTaxisEditor.style.display='none';},false);frmTaxisEditor.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmTaxisEditor);function LoadTaxiProvinces(){document.body.style.cursor='wait';var sd;NSB.ShowProgress("Loading...");cboTaxiProvince.clear();cboTaxiProvince.addItem("","");cboTaxiProvince.setIndex(0);cboTaxiPlaceName.clear();cboTaxiPlaceName.addItem("","");sqlList=[];sqlList[0]=["select Description from Provinces order by Description;",provincesTH,provincesTE];Sql(dbObj,sqlList);}
function LoadTaxiPlaceNames(sprov){document.body.style.cursor='wait';var sd;NSB.ShowProgress("Loading...");cboTaxiPlaceName.clear();cboTaxiPlaceName.addItem("","");cboTaxiPlaceName.setIndex(0);sqlList=[];sqlList[0]=["select PlaceName from Places WHERE ProvinceName = '"+sprov+"' order by PlaceName;",placesTH,provincesTE];Sql(dbObj,sqlList);}
function placesTH(transaction,results){savethefunction_rvar="";var row,sPlaceName,i;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sPlaceName=row["PlaceName"];cboTaxiPlaceName.addItem(sPlaceName,sPlaceName);}
NSB.ShowProgress(False);document.body.style.cursor='default';return savethefunction_rvar;}
function provincesTE(transaction,results){savethefunction_rvar="";NSB.ShowProgress(False);document.body.style.cursor='default';NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function provincesTH(transaction,results){savethefunction_rvar="";var row,sDescription,i;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sDescription=row["Description"];cboTaxiProvince.addItem(sDescription,sDescription);}
NSB.ShowProgress(False);document.body.style.cursor='default';return savethefunction_rvar;}
taxisEditorT.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(WhatToDo);break;case((choice)=="Services"):TaxiSave();}
return savethefunction_rvar;}
frmTaxisEditor.onshow=function(){savethefunction_rvar="";taxisEditor.Left=0;taxisEditor.Top=42;taxisEditor.Width=frmTaxisEditor.Width-20;var fw;fw=taxisEditor.Width/2;console.log(fw);cboTaxiProvince.Left=fw+10;cboTaxiPlaceName.Left=fw+10;cboTaxiProvince.Width=fw-10;cboTaxiPlaceName.Width=fw-10;LoadTaxiProvinces();var saction;saction=localStorage.getItem("action");var sid;acctName=localStorage.getItem("id");switch(True){case((saction)=="edit"):ReadTaxiById(sid);break;case((saction)=="add"):isnew=True;var sprov;sprov=localStorage.getItem("province");cboTaxiProvince.setText(sprov);taxisEditor.setValue(2,"");taxisEditor.setValue(3,"");taxisEditor.setValue(4,"");taxisEditor.setValue(5,"");taxisEditor.setValue(6,"");taxisEditor.setValue(7,"");taxisEditor.setValue(8,"");taxisEditor.setValue(9,"");}
return savethefunction_rvar;}
function ReadTaxiById(taxiID){savethefunction_rvar="";var sqlread;sqlread=[];sqlread[0]=["SELECT * FROM [Taxis] WHERE [ID] = "+taxiID+";",ReadTaxiH,ReadTaxiE];Sql(dbObj,sqlread);return savethefunction_rvar;}
function ReadTaxiE(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function ReadTaxiH(transaction,results){savethefunction_rvar="";var row,sid;var sProvince,sPlace,sCompanyName,sMobileNo;var sWebsite,sEmailAddress,sContactPerson,sTelephoneNo;var sFaxNo;row=results.rows.item(0);sid=row["ID"];sProvince=row["ProvinceName"];sPlace=row["PlaceName"];sCompanyName=row["CompanyName"];sWebsite=row["Website"];sEmailAddress=row["EmailAddress"];sContactPerson=row["ContactPerson"];sMobileNo=row["MobileNo"];sTelephoneNo=row["TelephoneNo"];sFaxNo=row["FaxNo"];cboTaxiProvince.setText(sProvince);cboTaxiPlaceName.setText(sPlace);taxisEditor.setValue(3,sCompanyName);taxisEditor.setValue(4,sWebsite);taxisEditor.setValue(5,sEmailAddress);taxisEditor.setValue(6,sContactPerson);taxisEditor.setValue(7,sMobileNo);taxisEditor.setValue(8,sTelephoneNo);taxisEditor.setValue(9,sFaxNo);isnew=False;return savethefunction_rvar;}
function TaxiSave(){var dbRecord,sid,iSave;var sProvince,sPlace,sCompanyName,sMobileNo;var sWebsite,sEmailAddress,sContactPerson,sTelephoneNo;var sFaxNo;sProvince=cboTaxiProvince.selectedItem();sPlace=cboTaxiPlaceName.selectedItem();sCompanyName=taxisEditor.getValue(3);sWebsite=taxisEditor.getValue(4);sEmailAddress=taxisEditor.getValue(5);sContactPerson=taxisEditor.getValue(6);sMobileNo=taxisEditor.getValue(7);sTelephoneNo=taxisEditor.getValue(8);sFaxNo=taxisEditor.getValue(9);sProvince=Trim(sProvince);sPlace=Trim(sPlace);sCompanyName=Trim(sCompanyName);sWebsite=Trim(sWebsite);sEmailAddress=Trim(sEmailAddress);sContactPerson=Trim(sContactPerson);sMobileNo=Trim(sMobileNo);sTelephoneNo=Trim(sTelephoneNo);sFaxNo=Trim(sFaxNo);iSave=0;if(Len(sProvince)==0){iSave=iSave+1;}
if(Len(sPlace)==0){iSave=iSave+1;}
if(Len(sCompanyName)==0){iSave=iSave+1;}
if(Len(sEmailAddress)==0){iSave=iSave+1;}
if(Len(sContactPerson)==0){iSave=iSave+1;}
if(Len(sMobileNo)==0){iSave=iSave+1;}
if(Len(sTelephoneNo)==0){iSave=iSave+1;}
if(iSave!=0){NSB.MsgBox("The taxi operator details are incomplete, please specify details for all fields with a star (*)!");cboTaxiProvince.focus();return;}
localStorage.setItem("province",sProvince);localStorage.setItem("place",sPlace);sProvince=InSingleQuote(sProvince);sPlace=InSingleQuote(sPlace);sCompanyName=InSingleQuote(sCompanyName);sWebsite=InSingleQuote(sWebsite);sEmailAddress=InSingleQuote(sEmailAddress);sContactPerson=InSingleQuote(sContactPerson);sMobileNo=InSingleQuote(sMobileNo);sTelephoneNo=InSingleQuote(sTelephoneNo);sFaxNo=InSingleQuote(sFaxNo);dbRecord=new Object();dbRecord["ProvinceName"]=sProvince;dbRecord["PlaceName"]=sPlace;dbRecord["CompanyName"]=sCompanyName;dbRecord["Website"]=sWebsite;dbRecord["EmailAddress"]=sEmailAddress;dbRecord["ContactPerson"]=sContactPerson;dbRecord["MobileNo"]=sMobileNo;dbRecord["TelephoneNo"]=sTelephoneNo;dbRecord["FaxNo"]=sFaxNo;if(isnew==True){InsertRecord("Taxis",dbRecord);}else{var dbUpdate;dbUpdate=new Object();dbUpdate["ID"]=sid;UpdateRecord("Taxis",dbRecord,dbUpdate);}
isnew=False;localStorage.setItem("action","edit");localStorage.setItem("id","");}
cboTaxiProvince.onchange=function(){savethefunction_rvar="";var sprov;sprov=cboTaxiProvince.selectedItem();LoadTaxiPlaceNames(sprov);return savethefunction_rvar;}
window.addEventListener('load',function(){frmTaxis.style.display='block';NSB.List_jqm_init('taxisL','',true,'100%',false);taxisL_ref=new iScroll('taxisL_scroller',{bounce:true,zoom:false});taxisL.refresh=function(){if(typeof taxisL_ref!='undefined')setTimeout(NSB.refresh,100,taxisL_ref)};NSB.addProperties(taxisL,taxisL_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('taxisL_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(taxisH);NSB.addDisableProperty(taxisH);if(typeof(taxisH.onclick)=='function'){if(typeof(taxisH_left)!='undefined')taxisH_left.onclick=function(){taxisH.onclick(taxisH_left.getAttribute('nsbvalue'))};if(typeof(taxisH_right)!='undefined')taxisH_right.onclick=function(){taxisH.onclick(taxisH_right.getAttribute('nsbvalue'))}};frmTaxis.style.display='none';},false);frmTaxis.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmTaxis);taxisL.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var strItem,staxi,hpos;strItem=taxisL.getItem(i);hpos=InStr(1,strItem,"Location:");hpos=hpos-1;strItem=Left(strItem,hpos);strItem=Replace(strItem,"Verified","");strItem=Replace(strItem,"Not","");strItem=Trim(strItem);localStorage.setItem("taxi",strItem);ChangeForm(frmTaxiOperations);return savethefunction_rvar;}
frmTaxis.onshow=function(){savethefunction_rvar="";document.body.style.cursor='wait';var sprov,splace,sheader,query;sprov=localStorage.getItem("province");splace=localStorage.getItem("place");if(Len(sprov)>0&&Len(splace)>0){sheader=sprov+" > "+splace;query="SELECT * FROM Taxis WHERE ProvinceName = '"+sprov+"' and PlaceName = '"+splace+"' ORDER BY Rating DESC;";}else{sheader=sprov;query="SELECT * FROM Taxis WHERE ProvinceName = '"+sprov+"' ORDER BY Rating DESC;";}
$("#taxisH h1").text(sheader+" Taxis");NSB.ShowProgress("Working on it...");taxisL.Top=taxisH.Height;taxisL.Height=frmTaxis.Height-taxisH.Height;ListViewRefresh(taxisL);var sqlList;sqlList=[];sqlList[0]=[query,LoadTaxisH,LoadTaxisE];Sql(dbObj,sqlList);return savethefunction_rvar;}
function LoadTaxisH(transaction,results){savethefunction_rvar="";ListViewClear(taxisL);var row,i,sCompanyName,sPlaceName,sWebsite;var sEmailAddress,sContactPerson,sMobileNo;var sFaxNo,sServices,sRatePerKM,sFleetSize,sRating;var sVerified,sTelephoneNo,sID,sProvinceName,sLine;for(i=0;i<=results.rows.length-1;i++){row=results.rows.item(i);sID=row["ID"];sProvinceName=row["ProvinceName"];sPlaceName=row["PlaceName"];sCompanyName=row["CompanyName"];sWebsite=row["Website"];sEmailAddress=row["EmailAddress"];sContactPerson=row["ContactPerson"];sMobileNo=row["MobileNo"];sTelephoneNo=row["TelephoneNo"];sFaxNo=row["FaxNo"];sServices=row["Services"];sRatePerKM=row["RatePerKM"];sFleetSize=row["FleetSize"];sVerified=row["Verified"];sRating=row["Rating"];if(IsNull(sProvinceName)==True){sProvinceName="";}
if(IsNull(sPlaceName)==True){sPlaceName="";}
if(IsNull(sCompanyName)==True){sCompanyName="";}
if(IsNull(sWebsite)==True){sWebsite="";}
if(IsNull(sEmailAddress)==True){sEmailAddress="";}
if(IsNull(sContactPerson)==True){sContactPerson="";}
if(IsNull(sMobileNo)==True){sMobileNo="";}
if(IsNull(sTelephoneNo)==True){sTelephoneNo="";}
if(IsNull(sFaxNo)==True){sFaxNo="";}
if(IsNull(sServices)==True){sServices="";}
if(IsNull(sRatePerKM)==True){sRatePerKM="0";}
if(IsNull(sFleetSize)==True){sFleetSize="0";}
if(IsNull(sVerified)==True){sVerified="N";}
if(IsNull(sRating)==True){sRating="0";}
sLine="Location: "+sPlaceName+", "+sProvinceName;if(Len(sWebsite)>0){sLine=sLine+"<p>Website : "+sWebsite+"</p>";}
if(Len(sEmailAddress)>0){sLine=sLine+"<p>Email Address : "+sEmailAddress+"</p>";}
if(Len(sContactPerson)>0){sLine=sLine+"<p>Contact Person : "+sContactPerson+"</p>";}
if(Len(sMobileNo)>0){sLine=sLine+"<p>Mobile No : "+sMobileNo+"</p>";}
if(Len(sTelephoneNo)>0){sLine=sLine+"<p>Telephone No : "+sTelephoneNo+"</p>";}
if(Len(sFaxNo)>0){sLine=sLine+"<p>Fax No : "+sFaxNo+"</p>";}
if(Len(sRatePerKM)>0){sLine=sLine+"<p>Rate Per KM : "+sRatePerKM+"</p>";}
if(Len(sFleetSize)>0){sLine=sLine+"<p>Fleet Size : "+sFleetSize+"</p>";}
if(sVerified=="N"){sVerified="<font color='red'><b>Not Verified</b></font>";}else{sVerified="<font color='green'><b>Verified</b></font>";}
ListViewAddTitleDescriptionSideContent(taxisL,sCompanyName,sLine,sRating,sVerified);}
ListViewRefresh(taxisL);NSB.ShowProgress(False);document.body.style.cursor='default';console.log(taxisL.innerHTML);return savethefunction_rvar;}
function LoadTaxisE(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
taxisH.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):var sfrom;sfrom=localStorage.getItem("fromscreen");switch(True){case((sfrom)=="places"):ChangeForm(frmPlaces);break;case((sfrom)=="taxis"):ChangeForm(frmPlacesTaxi);break;}}
return savethefunction_rvar;}
window.addEventListener('load',function(){frmTaxiOperations.style.display='block';NSB.List_jqm_init('taxiOperationsL','',true,'100%',false);taxiOperationsL_ref=new iScroll('taxiOperationsL_scroller',{bounce:true,zoom:false});taxiOperationsL.refresh=function(){if(typeof taxiOperationsL_ref!='undefined')setTimeout(NSB.refresh,100,taxiOperationsL_ref)};NSB.addProperties(taxiOperationsL,taxiOperationsL_scroller);(function(){var d,i,s=''.split(',');for(i=0;i<s.length;i++){if(trim(s[i])!=''){d=document.getElementById('taxiOperationsL_'+i);(function(i){d.onclick=function(){ChangeForm(document.getElementById(s[i]))}})(i)}}})()
NSB.addProperties(taxiOperationsH);NSB.addDisableProperty(taxiOperationsH);if(typeof(taxiOperationsH.onclick)=='function'){if(typeof(taxiOperationsH_left)!='undefined')taxiOperationsH_left.onclick=function(){taxiOperationsH.onclick(taxiOperationsH_left.getAttribute('nsbvalue'))};if(typeof(taxiOperationsH_right)!='undefined')taxiOperationsH_right.onclick=function(){taxiOperationsH.onclick(taxiOperationsH_right.getAttribute('nsbvalue'))}};frmTaxiOperations.style.display='none';},false);frmTaxiOperations.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmTaxiOperations);taxiOperationsL.onclick=function(i){savethefunction_rvar="";if(TypeName(i)=="object"){return savethefunction_rvar;}
var sPlace,sCompanyName,sMobileNo;var sWebsite,sEmailAddress,sContactPerson,sTelephoneNo,sFaxNo;sCompanyName=localStorage.getItem("tn_companyname");sWebsite=localStorage.getItem("tn_website");sEmailAddress=localStorage.getItem("tn_emailaddress");sContactPerson=localStorage.getItem("tn_contactperson");sMobileNo=localStorage.getItem("tn_mobileno");sTelephoneNo=localStorage.getItem("tn_telephoneno");sFaxNo=localStorage.getItem("tn_faxno");switch(True){case((i)==0):break;case((i)==1):if(Len(sMobileNo)==0){NSB.MsgBox("The mobile no for "+sCompanyName+" has not been specified. The call cannot be made.");return;}else{phone(sMobileNo);}
break;case((i)==2):if(Len(sTelephoneNo)==0){NSB.MsgBox("The telephone no for "+sCompanyName+" has not been specified. The call cannot be made.");return;}else{phone(sTelephoneNo);}
break;case((i)==3):break;case((i)==4):if(Left(sWebsite,7)!="http://"){sWebsite="http://"+sWebsite;}
location=sWebsite;break;case((i)==5):if(Len(sEmailAddress)==0){NSB.MsgBox("The email address for "+sCompanyName+" has not been specified. The email cannot be processed.");return;}else{email(sEmailAddress,"","");}}
return savethefunction_rvar;}
frmTaxiOperations.onshow=function(){savethefunction_rvar="";var staxi;staxi=localStorage.getItem("taxi");$("#taxiOperationsH h1").text(staxi);taxiOperationsL.Top=taxiOperationsH.Height;taxiOperationsL.Height=frmTaxiOperations.Height-taxiOperationsH.Height;ListViewClear(taxiOperationsL);ListViewAddTitleDescription(taxiOperationsL,"Make Booking","Make a booking of taxi services.");ListViewAddTitleDescription(taxiOperationsL,"Call Mobile No","Place a call to the specified mobile no.");ListViewAddTitleDescription(taxiOperationsL,"Call Telephone No","Place a call to the specified telephone no.");ListViewAddTitleDescription(taxiOperationsL,"Rate Service","Rate the service that you were provided by taxi operator.");ListViewAddTitleDescription(taxiOperationsL,"Visit Website","Visit the taxo operator website.");ListViewAddTitleDescription(taxiOperationsL,"Send Email","Send the taxi operator an email.");ListViewRefresh(taxiOperationsL);ReadTaxiByCompanyName(staxi);return savethefunction_rvar;}
taxiOperationsH.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Back"):ChangeForm(frmTaxis);}
return savethefunction_rvar;}
function ReadTaxiByCompanyName(staxi){savethefunction_rvar="";var sqlread;sqlread=[];sqlread[0]=["SELECT * FROM [Taxis] WHERE [CompanyName] = '"+staxi+"';",ReadTaxiCompanyH,ReadTaxiCompanyE];Sql(dbObj,sqlread);return savethefunction_rvar;}
function ReadTaxiCompanyE(transaction,results){savethefunction_rvar="";NSB.MsgBox("SQL Error: "+results.code+": "+results.message);return savethefunction_rvar;}
function ReadTaxiCompanyH(transaction,results){savethefunction_rvar="";var row,sid;var sProvince,sPlace,sCompanyName,sMobileNo;var sWebsite,sEmailAddress,sContactPerson,sTelephoneNo;var sFaxNo;row=results.rows.item(0);sid=row["ID"];sProvince=row["ProvinceName"];sPlace=row["PlaceName"];sCompanyName=row["CompanyName"];sWebsite=row["Website"];sEmailAddress=row["EmailAddress"];sContactPerson=row["ContactPerson"];sMobileNo=row["MobileNo"];sTelephoneNo=row["TelephoneNo"];sFaxNo=row["FaxNo"];localStorage.setItem("tn_companyname",sCompanyName);localStorage.setItem("tn_website",sWebsite);localStorage.setItem("tn_emailaddress",sEmailAddress);localStorage.setItem("tn_contactperson",sContactPerson);localStorage.setItem("tn_mobileno",sMobileNo);localStorage.setItem("tn_telephoneno",sTelephoneNo);localStorage.setItem("tn_faxno",sFaxNo);isnew=False;return savethefunction_rvar;}
window.addEventListener('load',function(){frmServices.style.display='block';NSB.addProperties(servicesH);NSB.addDisableProperty(servicesH);if(typeof(servicesH.onclick)=='function'){if(typeof(servicesH_left)!='undefined')servicesH_left.onclick=function(){servicesH.onclick(servicesH_left.getAttribute('nsbvalue'))};if(typeof(servicesH_right)!='undefined')servicesH_right.onclick=function(){servicesH.onclick(servicesH_right.getAttribute('nsbvalue'))}};txtServices.ontouchmove=function(e){e.stopPropagation()};NSB.addProperties(txtServices);frmServices.style.display='none';},false);frmServices.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};NSB.addProperties(frmServices);restoreT.onclick=function(choice){savethefunction_rvar="";if(TypeName(choice)=="object"){return savethefunction_rvar;}
switch(True){case((choice)=="Home"):ChangeForm(WhatToDo);break;case((choice)=="Restore"):dbJSON=txtRestore.value;dbJSON=Trim(dbJSON);if(Len(dbJSON)==0){NSB.MsgBox("Please replace the text with the copied text from the 'Backup' E-Mail!");return;}
NSB.ShowProgress("Working on it...");dbImport=JSON.parse(dbJSON);SQLImport(dbImport,dbObj,restoreComplete);}
return savethefunction_rvar;}
function restoreComplete(){savethefunction_rvar="";NSB.ShowProgress(False);ChangeForm(WhatToDo);return savethefunction_rvar;}
frmRestore.onshow=function(){savethefunction_rvar="";txtRestore.Left=10;txtRestore.Top=42;txtRestore.Height=frmRestore.Height-restoreT.Height-10;txtRestore.Width=frmRestore.Width-20;txtRestore.value=localStorage.getItem("backup");return savethefunction_rvar;}
window.addEventListener('load',function(){WhatToDo.style.display='block';Main();if(typeof(WhatToDo.onshow)=='function')WhatToDo.onshow();},false);var NSBCurrentForm=WhatToDo;